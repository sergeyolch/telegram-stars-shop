<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Telegram Stars Shop</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root {
            --tg-theme-bg-color: #efeff3;
            --tg-theme-text-color: #000000;
            --tg-theme-hint-color: #707579;
            --tg-theme-link-color: #3390ec;
            --tg-theme-button-color: #3390ec;
            --tg-theme-button-text-color: #ffffff;
            --tg-theme-secondary-bg-color: #ffffff;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            margin: 0;
            padding: 16px;
            background: var(--tg-theme-bg-color);
            color: var(--tg-theme-text-color);
        }
        
        .header {
            text-align: center;
            margin-bottom: 20px;
        }
        
        .card {
            background: var(--tg-theme-secondary-bg-color);
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 16px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        
        .gift-item {
            display: flex;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid rgba(0,0,0,0.05);
        }
        
        .gift-item img {
            width: 48px;
            height: 48px;
            border-radius: 8px;
            margin-right: 12px;
            object-fit: cover;
        }
        
        .gift-info {
            flex: 1;
        }
        
        .gift-title {
            font-weight: 500;
            margin-bottom: 4px;
        }
        
        .gift-stars {
            color: #FF9500;
            font-size: 14px;
        }
        
        .buy-btn {
            background: var(--tg-theme-button-color);
            color: var(--tg-theme-button-text-color);
            border: none;
            border-radius: 8px;
            padding: 8px 16px;
            font-weight: 500;
            cursor: pointer;
        }
        
        .balance-display {
            font-size: 18px;
            font-weight: bold;
            text-align: center;
            margin: 16px 0;
            color: var(--tg-theme-link-color);
        }
        
        .switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 24px;
            margin-left: 10px;
        }
        
        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        
        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 24px;
        }
        
        .slider:before {
            position: absolute;
            content: "";
            height: 16px;
            width: 16px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }
        
        input:checked + .slider {
            background-color: var(--tg-theme-button-color);
        }
        
        input:checked + .slider:before {
            transform: translateX(26px);
        }
        
        .tab-buttons {
            display: flex;
            margin-bottom: 16px;
            border-bottom: 1px solid rgba(0,0,0,0.1);
        }
        
        .tab-btn {
            flex: 1;
            text-align: center;
            padding: 12px;
            background: transparent;
            border: none;
            cursor: pointer;
            position: relative;
        }
        
        .tab-btn.active {
            font-weight: 500;
        }
        
        .tab-btn.active:after {
            content: '';
            position: absolute;
            bottom: -1px;
            left: 25%;
            width: 50%;
            height: 2px;
            background-color: var(--tg-theme-button-color);
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .stars-input-container {
            display: flex;
            margin: 20px 0;
        }
        
        .stars-input {
            flex: 1;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 8px 0 0 8px;
            font-size: 16px;
        }
        
        .stars-submit {
            background: var(--tg-theme-button-color);
            color: var(--tg-theme-button-text-color);
            border: none;
            border-radius: 0 8px 8px 0;
            padding: 0 16px;
            font-weight: 500;
            cursor: pointer;
        }
        
        .auto-gift-item {
            display: flex;
            align-items: center;
            padding: 12px;
            margin-bottom: 8px;
            background: var(--tg-theme-secondary-bg-color);
            border-radius: 8px;
        }
        
        .auto-gift-select {
            margin-right: 12px;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>üåü Stars & Gifts Shop</h1>
        <p>–ü–æ–∫—É–ø–∞–π—Ç–µ –∑–≤—ë–∑–¥—ã –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–π—Ç–µ —ç–∫—Å–∫–ª—é–∑–∏–≤–Ω—ã–µ –ø–æ–¥–∞—Ä–∫–∏</p>
    </div>
    
    <div class="balance-display" id="balance">0 ‚òÖ</div>
    
    <div class="tab-buttons">
        <button class="tab-btn active" data-tab="gifts">–ü–æ–¥–∞—Ä–∫–∏</button>
        <button class="tab-btn" data-tab="stars">–ö—É–ø–∏—Ç—å Stars</button>
        <button class="tab-btn" data-tab="auto">–ê–≤—Ç–æ–ø–æ–∫—É–ø–∫–∞</button>
    </div>
    
    <div class="tab-content active" id="gifts-tab">
        <div class="card">
            <h2>–î–æ—Å—Ç—É–ø–Ω—ã–µ –ø–æ–¥–∞—Ä–∫–∏</h2>
            <div id="gifts-container">
                <!-- –ü–æ–¥–∞—Ä–∫–∏ –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–µ–Ω—ã –∑–¥–µ—Å—å -->
            </div>
        </div>
    </div>
    
    <div class="tab-content" id="stars-tab">
        <div class="card">
            <h2>–ü–æ–ø–æ–ª–Ω–∏—Ç—å –±–∞–ª–∞–Ω—Å Stars</h2>
            <div class="stars-input-container">
                <input type="number" id="stars-amount" class="stars-input" placeholder="–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ Stars" min="100" value="1000">
                <button class="stars-submit" id="stars-submit">–ö—É–ø–∏—Ç—å</button>
            </div>
            <div id="stars-packages"></div>
        </div>
    </div>
    
    <div class="tab-content" id="auto-tab">
        <div class="card">
            <h2>–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø–æ–∫—É–ø–∫–∞</h2>
            <div style="display: flex; align-items: center; margin-bottom: 16px;">
                <span>–ê–≤—Ç–æ–ø–æ–∫—É–ø–∫–∞ –Ω–æ–≤—ã—Ö –ø–æ–¥–∞—Ä–∫–æ–≤:</span>
                <label class="switch">
                    <input type="checkbox" id="auto-purchase-toggle">
                    <span class="slider"></span>
                </label>
            </div>
            
            <h3>–í—ã–±–µ—Ä–∏—Ç–µ –ø–æ–¥–∞—Ä–∫–∏ –¥–ª—è –∞–≤—Ç–æ–ø–æ–∫—É–ø–∫–∏</h3>
            <div id="auto-gifts-container">
                <!-- –°–ø–∏—Å–æ–∫ –ø–æ–¥–∞—Ä–∫–æ–≤ –¥–ª—è –∞–≤—Ç–æ–ø–æ–∫—É–ø–∫–∏ -->
            </div>
        </div>
    </div>

    <script>
        // –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
        const CONFIG = {
            botToken: "7201744365:AAGmXicLrg8ZOIkxWu-vPV2O5qlF2aoUKu0",
            paymentToken: "1744374395:TEST:b7b8d4c48eecf7fe6c92",
            chatId: "7201744365",
            apiUrl: "https://api.telegram.org/bot7201744365:AAGmXicLrg8ZOIkxWu-vPV2O5qlF2aoUKu0"
        };

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Telegram WebApp
        const tg = window.Telegram.WebApp;
        tg.expand();

        // –°–æ—Å—Ç–æ—è–Ω–∏–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
        let state = {
            balance: 500, // –ù–∞—á–∞–ª—å–Ω—ã–π –±–∞–ª–∞–Ω—Å –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏
            gifts: [],
            autoPurchase: {
                enabled: false,
                selectedGifts: []
            }
        };

        // –î–µ–º–æ-–¥–∞–Ω–Ω—ã–µ –ø–æ–¥–∞—Ä–∫–æ–≤
        const DEMO_GIFTS = [
            {
                id: "gift1",
                title: "–ó–æ–ª–æ—Ç–∞—è –∫–æ—Ä–æ–Ω–∞",
                stars: 500,
                photo_url: "https://via.placeholder.com/150/FFD700/000000?text=Crown"
            },
            {
                id: "gift2",
                title: "–ê–ª–º–∞–∑",
                stars: 1000,
                photo_url: "https://via.placeholder.com/150/00BFFF/000000?text=Diamond"
            },
            {
                id: "gift3",
                title: "–†–∞–∫–µ—Ç–∞",
                stars: 2500,
                photo_url: "https://via.placeholder.com/150/FF6347/000000?text=Rocket"
            },
            {
                id: "gift4",
                title: "–°–µ—Ä–¥—Ü–µ",
                stars: 100,
                photo_url: "https://via.placeholder.com/150/FF69B4/000000?text=Heart"
            },
            {
                id: "gift5",
                title: "–û–≥–Ω–µ–Ω–Ω—ã–π —à–∞—Ä",
                stars: 750,
                photo_url: "https://via.placeholder.com/150/FF4500/000000?text=Fire"
            }
        ];

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
        async function initApp() {
            if (!tg.initDataUnsafe?.user) {
                showAlert("–û—à–∏–±–∫–∞: –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –∑–∞–ø—É—â–µ–Ω–æ —á–µ—Ä–µ–∑ Telegram");
                return;
            }

            // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö
            loadGifts();
            updateBalanceDisplay();
            setupEventListeners();
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ —Å–ø–∏—Å–∫–∞ –ø–æ–¥–∞—Ä–∫–æ–≤
        function loadGifts() {
            // –í —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –∑–¥–µ—Å—å –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –∑–∞–ø—Ä–æ—Å –∫ payments.getStarGifts
            state.gifts = DEMO_GIFTS;
            renderGifts();
            renderAutoGifts();
        }

        // –†–µ–Ω–¥–µ—Ä –ø–æ–¥–∞—Ä–∫–æ–≤
        function renderGifts() {
            const container = document.getElementById('gifts-container');
            container.innerHTML = '';
            
            state.gifts.forEach(gift => {
                const giftElement = document.createElement('div');
                giftElement.className = 'gift-item';
                giftElement.innerHTML = `
                    <img src="${gift.photo_url}" alt="${gift.title}">
                    <div class="gift-info">
                        <div class="gift-title">${gift.title}</div>
                        <div class="gift-stars">${gift.stars} ‚òÖ</div>
                    </div>
                    <button class="buy-btn" data-id="${gift.id}">–ö—É–ø–∏—Ç—å</button>
                `;
                container.appendChild(giftElement);
            });
        }

        // –†–µ–Ω–¥–µ—Ä –ø–æ–¥–∞—Ä–∫–æ–≤ –¥–ª—è –∞–≤—Ç–æ–ø–æ–∫—É–ø–∫–∏
        function renderAutoGifts() {
            const container = document.getElementById('auto-gifts-container');
            container.innerHTML = '';
            
            state.gifts.forEach(gift => {
                const isSelected = state.autoPurchase.selectedGifts.includes(gift.id);
                
                const giftElement = document.createElement('div');
                giftElement.className = 'auto-gift-item';
                giftElement.innerHTML = `
                    <input type="checkbox" class="auto-gift-select" id="auto-gift-${gift.id}" 
                           data-id="${gift.id}" ${isSelected ? 'checked' : ''}>
                    <img src="${gift.photo_url}" alt="${gift.title}" width="40" height="40">
                    <div class="gift-info" style="flex: 1;">
                        <div class="gift-title">${gift.title}</div>
                        <div class="gift-stars">${gift.stars} ‚òÖ</div>
                    </div>
                `;
                container.appendChild(giftElement);
            });
        }

        // –û—Ç–ø—Ä–∞–≤–∫–∞ –ø–æ–¥–∞—Ä–∫–∞
        async function sendGift(giftId) {
            const gift = state.gifts.find(g => g.id === giftId);
            if (!gift) return;

            if (state.balance >= gift.stars) {
                state.balance -= gift.stars;
                updateBalanceDisplay();
                showAlert(`–ü–æ–¥–∞—Ä–æ–∫ "${gift.title}" —É—Å–ø–µ—à–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω!`);
                
                // –í —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –∑–¥–µ—Å—å –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –≤—ã–∑–æ–≤ API –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –ø–æ–¥–∞—Ä–∫–∞
                console.log(`–û—Ç–ø—Ä–∞–≤–ª–µ–Ω –ø–æ–¥–∞—Ä–æ–∫: ${gift.title}`);
            } else {
                showAlert(`–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –∑–≤—ë–∑–¥. –ù—É–∂–Ω–æ –µ—â—ë ${gift.stars - state.balance} ‚òÖ`);
            }
        }

        // –ü–æ–∫—É–ø–∫–∞ –∑–≤—ë–∑–¥
        function buyStars(amount) {
            // –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Å—É–º–º–∞ - 100 stars
            amount = Math.max(100, parseInt(amount) || 100);
            
            // –†–∞—Å—á–µ—Ç —Ü–µ–Ω—ã (–¥–µ–º–æ-–ª–æ–≥–∏–∫–∞: 100 stars = $1)
            const price = (amount / 100).toFixed(2);
            
            tg.openInvoice({
                title: `–ü–æ–∫—É–ø–∫–∞ ${amount} Telegram Stars`,
                description: `–ü–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞ –Ω–∞ ${amount} stars`,
                currency: "USD",
                prices: [{ label: "Stars", amount: price * 100 }], // –í —Ü–µ–Ω—Ç–∞—Ö
                payload: JSON.stringify({
                    type: "stars_purchase",
                    user_id: tg.initDataUnsafe.user.id,
                    amount: amount
                }),
                provider_token: CONFIG.paymentToken
            }, (status) => {
                if (status === 'paid') {
                    state.balance += amount;
                    updateBalanceDisplay();
                    showAlert(`–ë–∞–ª–∞–Ω—Å –ø–æ–ø–æ–ª–Ω–µ–Ω –Ω–∞ ${amount} stars!`);
                    
                    // –í —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –∑–¥–µ—Å—å –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –≤—ã–∑–æ–≤ API –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –±–∞–ª–∞–Ω—Å–∞
                    console.log(`–ö—É–ø–ª–µ–Ω–æ ${amount} stars`);
                }
            });
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –±–∞–ª–∞–Ω—Å–∞
        function updateBalanceDisplay() {
            document.getElementById('balance').textContent = `${state.balance} ‚òÖ`;
        }

        // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ —Å–æ–±—ã—Ç–∏–π
        function setupEventListeners() {
            // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –≤–∫–ª–∞–¥–æ–∫
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
                    document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
                    
                    btn.classList.add('active');
                    document.getElementById(`${btn.dataset.tab}-tab`).classList.add('active');
                });
            });
            
            // –ö–Ω–æ–ø–∫–∏ –ø–æ–∫—É–ø–∫–∏ –ø–æ–¥–∞—Ä–∫–æ–≤
            document.addEventListener('click', (e) => {
                if (e.target.classList.contains('buy-btn') && e.target.dataset.id) {
                    sendGift(e.target.dataset.id);
                }
            });
            
            // –ö–Ω–æ–ø–∫–∞ –ø–æ–∫—É–ø–∫–∏ stars
            document.getElementById('stars-submit').addEventListener('click', () => {
                const amount = document.getElementById('stars-amount').value;
                buyStars(amount);
            });
            
            // –ü–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å –∞–≤—Ç–æ–ø–æ–∫—É–ø–∫–∏
            document.getElementById('auto-purchase-toggle').addEventListener('change', (e) => {
                state.autoPurchase.enabled = e.target.checked;
                console.log('–ê–≤—Ç–æ–ø–æ–∫—É–ø–∫–∞:', state.autoPurchase.enabled ? '–≤–∫–ª—é—á–µ–Ω–∞' : '–≤—ã–∫–ª—é—á–µ–Ω–∞');
            });
            
            // –í—ã–±–æ—Ä –ø–æ–¥–∞—Ä–∫–æ–≤ –¥–ª—è –∞–≤—Ç–æ–ø–æ–∫—É–ø–∫–∏
            document.addEventListener('change', (e) => {
                if (e.target.classList.contains('auto-gift-select')) {
                    const giftId = e.target.dataset.id;
                    
                    if (e.target.checked) {
                        if (!state.autoPurchase.selectedGifts.includes(giftId)) {
                            state.autoPurchase.selectedGifts.push(giftId);
                        }
                    } else {
                        state.autoPurchase.selectedGifts = state.autoPurchase.selectedGifts.filter(id => id !== giftId);
                    }
                    
                    console.log('–í—ã–±—Ä–∞–Ω–Ω—ã–µ –ø–æ–¥–∞—Ä–∫–∏:', state.autoPurchase.selectedGifts);
                }
            });
        }

        // –ü–æ–∫–∞–∑ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
        function showAlert(message) {
            tg.showAlert(message);
        }

        // –ó–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
        document.addEventListener('DOMContentLoaded', initApp);
    </script>
</body>
</html>
